<!doctype html><html lang='ja'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><style>
*{box-sizing:border-box}
:root{
  --bg:#ffffff; --panel:#ffffff; --border:#e5e7eb; --accent:#e11d48;
  --text:#111111; --muted:#6b7280; --header-h: 128px;
}
body{ margin:0;color:var(--text);background:var(--bg);font-family:Inter,system-ui,'Noto Sans JP',sans-serif; padding-top: var(--header-h); }
header{
  position:fixed;top:0;left:0;right:0;z-index:1000;background:#fff;border-bottom:1px solid var(--border);
  padding:10px 16px; box-shadow:0 2px 10px rgba(0,0,0,.04);
}
.header-wrap{
  max-width:1200px;margin:0 auto;display:grid;gap:8px;width:100%;
  grid-template-columns:auto 1fr auto;
  grid-template-areas:
    "logo title spacer"
    "actions actions actions";
  align-items:center;
}
.brand-left{grid-area:logo;display:flex;align-items:center;gap:12px;min-width:0}
.brand-left img{height:64px;display:block}
.center-ttl{
  grid-area:title; font-weight:1000; text-align:center;
  font-size:clamp(28px, 5.2vw, 52px); line-height:1.05; color:#111;
}
.right-spacer{grid-area:spacer;}
.actions{grid-area:actions;display:flex;align-items:center;gap:10px;justify-content:center}
.iconbtn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;color:#111;border-radius:12px;padding:9px 12px;text-decoration:none;font-size:13px;transition:transform .12s ease, background .12s ease}
.iconbtn:hover{background:#f9fafb; transform:translateY(-1px)}
.iconbtn svg{width:16px;height:16px;display:block;color:#111}

.wrap{max-width:1200px;margin:0 auto;padding:12px 16px}
.controls{
  display:grid;grid-template-columns:repeat(2, minmax(180px,1fr));
  grid-template-areas: "q1 q2" "q3 q4" "acts acts";
  gap:10px;margin:10px 0 14px;align-items:center;
}
#nameQ{grid-area:q1}
#codeQ{grid-area:q2}
#packQ{grid-area:q3}
#rarityQ{grid-area:q4}
.controls .btns{ grid-area:acts; display:flex; gap:8px; flex-wrap:wrap }

input.search{background:#fff;border:1px solid var(--border);color:#111;border-radius:12px;padding:11px 12px;font-size:14px;outline:none;min-width:0;transition:box-shadow .12s ease;width:100%}
input.search::placeholder{color:#9ca3af}
input.search:focus{ box-shadow:0 0 0 2px rgba(17,24,39,.08) }
.btn{background:#fff;border:1px solid var(--border);color:#111;border-radius:12px;padding:9px 12px;font-size:13px;cursor:pointer;text-decoration:none;white-space:nowrap;transition:transform .12s ease, background .12s ease}
.btn:hover{background:#f9fafb; transform:translateY(-1px)}
.btn.active{outline:2px solid var(--accent)}

.grid{margin:12px 0;width:100%}
.grid.grid-img{display:grid;grid-template-columns:repeat(4, minmax(0,1fr));gap:12px}
.grid.grid-list{display:grid;grid-template-columns:repeat(2, minmax(0,1fr));gap:12px}
.card{
  background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.04);transition:transform .15s ease, box-shadow .15s ease;
  content-visibility:auto; contain-intrinsic-size: 600px 800px;
}
.card:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.06)}
.th{aspect-ratio:3/4;background:#f3f4f6;cursor:zoom-in}
.th img{width:100%;height:100%;object-fit:cover;display:block;background:#f3f4f6}
.b{padding:10px 12px}

/* 型番のめり込み対策：バッジ化＋nowrap、タイトルはflexで折返し最適化 */
.n{font-size:14px;font-weight:800;line-height:1.25;margin:0 0 6px;color:#111;display:flex;gap:6px;align-items:baseline;flex-wrap:wrap;word-break:break-word}
.n .code{margin-left:0;font-weight:700;font-size:12px;color:#374151;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:8px;padding:2px 6px;white-space:nowrap}

.meta{font-size:11px;color:var(--muted);word-break:break-word}
.p{margin-top:6px;display:flex;flex-wrap:wrap}
.mx{font-weight:1000;color:var(--accent);font-size:clamp(16px, 2.4vw, 22px);line-height:1.05;text-shadow:none;white-space:nowrap;display:inline-block;max-width:100%}
.grid.grid-img .meta{display:none}

nav.simple{display:flex;justify-content:center;align-items:center;margin:14px 0;gap:14px;flex-wrap:wrap}
nav.simple a{color:#111;background:#fff;border:1px solid var(--border);padding:8px 16px;border-radius:12px;text-decoration:none;white-space:nowrap}
nav.simple a.disabled{opacity:.45;pointer-events:none}
nav.simple strong{color:#111;user-select:none}

.viewer{position:fixed; inset:0; background:rgba(0,0,0,.86); display:none; align-items:center; justify-content:center; z-index:2000}
.viewer.show{display:flex}
.viewer .vc{position:relative;max-width:92vw;max-height:92vh}
.viewer img{max-width:92vw;max-height:92vh;display:block}
.viewer button.close{position:absolute;top:-12px;right:-12px;background:#fff;border:1px solid var(--border);color:#111;border-radius:999px;width:38px;height:38px;cursor:pointer}

@media (max-width:700px){
  :root{ --header-h: 136px; }
  .brand-left img{height:56px}
  .center-ttl{ font-size:clamp(24px, 7vw, 36px) }
  .wrap{ padding:4px }
  .grid.grid-img{ gap:2px }
  .b{padding:6px}
  .n{font-size:12px}
  .n .code{font-size:11px;padding:1px 6px;border-radius:6px}
  .mx{ font-size:clamp(12px, 4.2vw, 16px); white-space:nowrap }
  nav.simple{gap:8px; flex-wrap:nowrap; justify-content:space-between}
  nav.simple a{padding:6px 10px; font-size:12px; display:inline-flex}
  nav.simple strong{font-size:12px}
}
small.note{color:var(--muted)}
</style></head><body><header><div class='header-wrap'><div class='brand-left'><div class='brand-fallback' aria-label='Shop Logo'>YOUR SHOP</div></div><div class='center-ttl'>デュエマ買取表</div><div class='right-spacer'></div><div class='actions'><a class='iconbtn' href='https://www.climax-card.jp/' target='_blank' rel='noopener'><svg viewBox='0 0 24 24' aria-hidden='true' fill='currentColor'><path d='M3 9.5V8l2.2-3.6c.3-.5.6-.7 1-.7h11.6c.4 0 .7.2.9.6L21 8v1.5c0 1-.8 1.8-1.8 1.8-.9 0-1.6-.6-1.8-1.4-.2.8-.9 1.4-1.8 1.4s-1.6-.6-1.8-1.4c-.2.8-.9 1.4-1.8 1.4s-1.6-.6-1.8-1.4c-.2.8-.9 1.4-1.8 1.4s-1.6-.6-1.8-1.4c-.2.8-.9 1.4-1.8 1.4s-1.6-.6-1.8-1.4c-.2.8-.9 1.4-1.8 1.4C3.8 11.3 3 10.5 3 9.5zM5 12.5h14V20c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-7.5zm4 1.5v5h6v-5H9zM6.3 5.2 5 7.5h14l-1.3-2.3H6.3z'/></svg><span>Shop</span></a><a class='iconbtn' href='https://www.climax-card.jp/member-login' target='_blank' rel='noopener'><svg viewBox='0 0 24 24' aria-hidden='true' fill='currentColor'><path d='M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4.418 0-8 2.239-8 5v2h16v-2c0-2.761-3.582-5-8-5z'/></svg><span>Login</span></a></div></div></header><main class='wrap'><div class='controls'>  <input id='nameQ'   class='search' placeholder='名前：部分一致（ひらがな可）'>  <input id='codeQ'   class='search' placeholder='型番：例 SP4/SP5, 19/100 等'>  <input id='packQ'   class='search' placeholder='弾：例 DM25RP1, 邪神VS邪神 等'>  <input id='rarityQ' class='search' placeholder='レアリティ：SR/VR 等'>  <div class='btns'>    <button id='btnPriceDesc' class='btn' type='button' aria-pressed='false'>価格高い順</button>    <button id='btnPriceAsc'  class='btn' type='button' aria-pressed='false'>価格低い順</button>    <button id='btnSortClear' class='btn' type='button' aria-pressed='false'>標準順</button>    <button id='btnToggleImages' class='btn' type='button'>画像ON</button>  </div></div>  <nav class='simple'></nav><div id='grid' class='grid grid-img'></div><nav class='simple'></nav>  <small class='note'>このページ内のデータのみで検索・並び替え・ページングできます。画像クリックで拡大表示。</small></main><script>window.__CARDS__=[{"n":"“雨にそよいで晴れを請う”長崎そよ","p":"","c":"BD/W125-P15","r":"PR","b":"BanG Dream! It's MyGO!!!!! 雨にそよいで晴れを請う（１）カード付き特装版","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"“雨にそよいで晴れを請う”長崎そよbdw125p15prbangdream!it'smygo!!!!!雨にそよいで晴れを請う(1)かーど付き特装版"},{"n":"”我、悲しみを恐れるなかれ” ドロリス","p":"","c":"BD/W125-P19","r":"PR","b":"サプライセット 『BanG Dream! Ave Mujica』","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"”我、悲しみを恐れるなかれ”どろりすbdw125p19prさぷらいせっと『bangdream!avemujica』"},{"n":"”心の叫び” 高松燈","p":"","c":"BD/W125-P18","r":"PR","b":"サプライセット 『BanG Dream! MyGO!!!!!』","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"”心の叫び”高松燈bdw125p18prさぷらいせっと『bangdream!mygo!!!!!』"},{"n":"4Kヒロイン 杏菜","p":"","c":"MKI/W126-P01","r":"PR","b":"カードゲーム祭2025 入場特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"4kひろいん杏菜mkiw126p01prかーどげーむ祭2025入場特典"},{"n":"Happy 17th Anniversary !! [祭]","p":"","c":"WS/WSPR-P17","r":"PR","b":"カードゲーム祭2025 入場特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"happy17thanniversary!![祭]wswsprp17prかーどげーむ祭2025入場特典"},{"n":"紅葉乃舞姫 日野下 花帆","p":"","c":"LHS/W122-P03","r":"PR","b":"カードゲーム祭2025 入場特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"紅葉乃舞姫日野下花帆lhsw122p03prかーどげーむ祭2025入場特典"},{"n":"Ave Mujica","p":"","c":"BD/W125-P17S","r":"PR","b":"MyGO!!!!!×Ave Mujica 合同ライブ「わかれ道の、その先へ」2日目来場特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"avemujicabdw125p17sprmygo!!!!!×avemujica合同らいぶ「わかれ道の、その先へ」2日目来場特典"},{"n":"MyGO!!!!!","p":"","c":"BD/W125-P16S","r":"PR","b":"MyGO!!!!!×Ave Mujica 合同ライブ「わかれ道の、その先へ」1日目来場特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"mygo!!!!!bdw125p16sprmygo!!!!!×avemujica合同らいぶ「わかれ道の、その先へ」1日目来場特典"},{"n":"トキメキ。この先も、ずっと","p":"","c":"LNJ/W85-P07d","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。この先も、ずっとlnjw85p07dpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。この先も、ずっと","p":"","c":"LNJ/W85-P07c","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。この先も、ずっとlnjw85p07cpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。この先も、ずっと","p":"","c":"LNJ/W85-P07b","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。この先も、ずっとlnjw85p07bpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。この先も、ずっと","p":"","c":"LNJ/W85-P07a","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。この先も、ずっとlnjw85p07apr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。大切な時間","p":"","c":"LNJ/W85-P06d","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。大切な時間lnjw85p06dpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。大切な時間","p":"","c":"LNJ/W85-P06c","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。大切な時間lnjw85p06cpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。大切な時間","p":"","c":"LNJ/W85-P06b","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。大切な時間lnjw85p06bpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。大切な時間","p":"","c":"LNJ/W85-P06a","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。大切な時間lnjw85p06apr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。あなたがいてくれたから","p":"","c":"LNJ/W85-P05d","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。あなたがいてくれたからlnjw85p05dpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。あなたがいてくれたから","p":"","c":"LNJ/W85-P05c","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。あなたがいてくれたからlnjw85p05cpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。あなたがいてくれたから","p":"","c":"LNJ/W85-P05b","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。あなたがいてくれたからlnjw85p05bpr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"トキメキ。あなたがいてくれたから","p":"","c":"LNJ/W85-P05a","r":"PR","b":"「ラブライブ！虹ヶ咲学園スクールアイドル同好会 トキメキの未来地図」特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"ときめき。あなたがいてくれたからlnjw85p05apr「らぶらいぶ!虹ヶ咲学園すくーるあいどる同好会ときめきの未来地図」特典"},{"n":"【後攻】 甘神さんちの縁結び（甘神朝姫）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【後攻】甘神さんちの縁結び(甘神朝姫)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"【後攻】 甘神さんちの縁結び（甘神夕奈）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【後攻】甘神さんちの縁結び(甘神夕奈)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"【後攻】 甘神さんちの縁結び（甘神夜重）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【後攻】甘神さんちの縁結び(甘神夜重)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"【先攻】 甘神さんちの縁結び（甘神朝姫）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【先攻】甘神さんちの縁結び(甘神朝姫)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"【先攻】 甘神さんちの縁結び（甘神夕奈）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【先攻】甘神さんちの縁結び(甘神夕奈)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"【先攻】 甘神さんちの縁結び（甘神夜重）","p":"","c":"","r":"","b":"ブースターパック 甘神さんちの縁結び BOX特典","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"【先攻】甘神さんちの縁結び(甘神夜重)ぶーすたーぱっく甘神さんちの縁結びbox特典"},{"n":"朝の舞","p":"","c":"AMG/W121-100R","r":"RRR","b":"ブースターパック 甘神さんちの縁結び","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"朝の舞amgw121100rrrrぶーすたーぱっく甘神さんちの縁結び"},{"n":"朝の舞","p":"","c":"AMG/W121-100","r":"CR","b":"ブースターパック 甘神さんちの縁結び","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"朝の舞amgw121100crぶーすたーぱっく甘神さんちの縁結び"},{"n":"「妹」のままではいられない","p":"","c":"AMG/W121-099R","r":"RRR","b":"ブースターパック 甘神さんちの縁結び","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"「妹」のままではいられないamgw121099rrrrぶーすたーぱっく甘神さんちの縁結び"},{"n":"「妹」のままではいられない","p":"","c":"AMG/W121-099EX","r":"RRR+","b":"ブースターパック 甘神さんちの縁結び","pr":0,"i":"https://dm.takaratomy.co.jp/wp-content/card/cardimage/True.jpg","t":"","s":"「妹」のままではいられないamgw121099exrrr+ぶーすたーぱっく甘神さんちの縁結び"}];</script><div id='viewer' class='viewer'><div class='vc'><img id='viewerImg' alt=''><button id='viewerClose' class='close'>×</button></div></div><script>
(function(){
  const header = document.querySelector('header');
  const setHeaderH = () => {
    const h = header?.offsetHeight || 128;
    document.documentElement.style.setProperty('--header-h', h + 'px');
  };
  setHeaderH();
  window.addEventListener('resize', setHeaderH);

  const nameQ  = document.getElementById('nameQ');
  const codeQ  = document.getElementById('codeQ');
  const packQ  = document.getElementById('packQ');
  const rarityQ= document.getElementById('rarityQ');
  const grid   = document.getElementById('grid');
  const navs   = [...document.querySelectorAll('nav.simple')];

  const btnDesc  = document.getElementById('btnPriceDesc');
  const btnAsc   = document.getElementById('btnPriceAsc');
  const btnNone  = document.getElementById('btnSortClear');
  const btnImg   = document.getElementById('btnToggleImages');

  const viewer = document.getElementById('viewer');
  const viewerImg = document.getElementById('viewerImg');
  const viewerClose = document.getElementById('viewerClose');

  const isMobile = matchMedia('(max-width: 700px)').matches;
  const netType = navigator.connection?.effectiveType || '';
  const slowNet = /^(slow-2g|2g|3g)$/i.test(netType);
  const cores = navigator.hardwareConcurrency || 4;

  const __PER = 80;
  const PER_PAGE_ADJ = (isMobile || slowNet || cores <= 4) ? Math.min(__PER, 48) : __PER;

  function pick(nLo, nMd, nHi){
    return (cores <= 4) ? nLo : ((isMobile || slowNet) ? nMd : nHi);
  }
  const eager1 = pick(4, 8, 16);
  const eager2 = pick(8, 16, 32);

  // 初期表示は画像ON
  let showImages;
  let saved = localStorage.getItem('showImages');
  if (saved === 'true')  { localStorage.setItem('showImages','1'); saved = '1'; }
  if (saved === 'false') { localStorage.setItem('showImages','0'); saved = '0'; }
  if (saved === null) showImages = true;
  else showImages = (saved === '1');

  const SEP_RE = /[\s\u30FB\u00B7·/／\-_—–−]+/g;
  function kataToHira(str){ return (str||'').replace(/[\u30A1-\u30FA]/g, ch => String.fromCharCode(ch.charCodeAt(0)-0x60)); }
  const kanjiReadingMap = { "伝説":"でんせつ" };
  const latinAliasMap = { "complex": "こんぷれっくす", "c0br4": "こぶら" };

  function normalizeForSearch(s){
    s = (s||'').normalize('NFKC').toLowerCase();
    for(const [k,v] of Object.entries(latinAliasMap)){ s = s.split(k).join(v); }
    for(const [k,v] of Object.entries(kanjiReadingMap)){ s = s.split(k).join(v); }
    s = kataToHira(s).replace(SEP_RE, '');
    return s;
  }
  function normalizeLatin(s){
    s = (s||'').normalize('NFKC').toLowerCase()
      .replace(/0/g,'o').replace(/1/g,'l').replace(/3/g,'e').replace(/4/g,'a').replace(/5/g,'s').replace(/7/g,'t')
      .replace(SEP_RE, '').replace(/[^a-z0-9]/g,'');
    return s;
  }

  function fmtYen(n){ return (n==null||n==='')?'-':('¥'+parseInt(n,10).toLocaleString()); }
  function escHtml(s){
    return (s||'').replace(/[&<>\"']/g, m => ({ "&":"&amp;", "<":"&lt;", ">":"&gt;", "\"":"&quot;", "'":"&#39;" }[m]));
  }

  function norm(it){
    return {
      name: it.n ?? it.name ?? "",
      pack: it.p ?? it.pack ?? "",
      code: it.c ?? it.code ?? "",
      rarity: it.r ?? it.rarity ?? "",
      booster: it.b ?? it.booster ?? "",
      price: (it.pr ?? it.price ?? null),
      image: it.i ?? it.image ?? "",
      thumb: it.t ?? it.thumb ?? "",
      s: it.s ?? ""
    };
  }
  let ALL = Array.isArray(window.__CARDS__) ? window.__CARDS__.map(norm) : [];
  if (!ALL.length) {
    const hint = document.createElement('p');
    hint.style.cssText='color:#dc2626;padding:10px;margin:10px;border:1px dashed #fecaca;background:#fff5f5';
    hint.textContent = 'データが0件です。入力CSV/Excelのヘッダと列位置を確認してください。';
    document.querySelector('main')?.prepend(hint);
  }

  ALL = ALL.map(it => ({
    ...it,
    _name:        normalizeForSearch(it.name || ""),
    _code:        normalizeForSearch(it.code || ""),
    _packbooster: normalizeForSearch([it.pack || "", it.booster || ""].join(" ")),
    _rarity:      normalizeForSearch(it.rarity || ""),
    _name_lat:        normalizeLatin(it.name || ""),
    _code_lat:        normalizeLatin(it.code || ""),
    _packbooster_lat: normalizeLatin([it.pack || "", it.booster || ""].join(" ")),
    _rarity_lat:      normalizeLatin(it.rarity || "")
  }));

  let VIEW=[]; let page=1; let currentSort='desc';

  function shrinkPrices(root=document){
    const MIN_PX = 10;
    root.querySelectorAll('.mx').forEach(el=>{
      const style = window.getComputedStyle(el);
      let size = parseFloat(style.fontSize) || 14;
      const fits = () => el.scrollWidth <= el.clientWidth;
      if (fits()) return;
      while (!fits() && size > MIN_PX) { size -= 1; el.style.fontSize = size + 'px'; }
    });
  }

  // 画像ON時は「カード名＋型番＋価格のみ」
  function cardHTML_img(it){
    const nameEsc = escHtml(it.name||'');
    const full = it.image||'';
    const codeEsc = escHtml(it.code||'');
    let thumb = it.thumb || full;
    const hasHttp = /^https?:\/\//.test(thumb);
    if (thumb && !hasHttp && !thumb.startsWith('../')) thumb = '../' + thumb;
    const codeHtml = codeEsc ? `<span class="code">[${codeEsc}]</span>` : '';
    return `
  <article class="card">
    <div class="th" data-full="${full}">
      <img alt="${nameEsc}" loading="lazy" decoding="async"
           width="600" height="800"
           data-src="${thumb}" src=""
           onerror="this.onerror=null;var p=this.closest('.th');this.src=p?p.getAttribute('data-full'):this.src;">
    </div>
    <div class="b">
      <h3 class="n">${nameEsc}${codeHtml}</h3>
      <div class="p"><span class="mx">${fmtYen(it.price)}</span></div>
    </div>
  </article>`;
  }

  function cardHTML_list(it){
    const nameEsc = escHtml(it.name||'');
    const meta = [it.code||'', [it.pack||'', it.booster||''].filter(Boolean).join(' / ')].filter(Boolean).join(' ・ ');
    return `
  <article class="card">
    <div class="b">
      <h3 class="n">${nameEsc}</h3>
      <div class="meta">${escHtml(meta)}</div>
      <div class="p"><span class="mx">${fmtYen(it.price)}</span></div>
    </div>
  </article>`;
  }

  let io;
  function setupIO(){
    if (io) io.disconnect();
    io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if (e.isIntersecting){
          const img = e.target;
          const ds = img.getAttribute('data-src');
          if (ds && !img.src){ img.src = ds; img.removeAttribute('data-src'); }
          io.unobserve(img);
        }
      });
    }, { rootMargin: (isMobile || slowNet) ? "300px 0px" : "600px 0px", threshold: 0.01 });

    document.querySelectorAll('#grid img[data-src]').forEach(img=>io.observe(img));
    document.querySelectorAll('#grid img').forEach((img, i)=>{ img.setAttribute('fetchpriority', i < 8 ? 'high' : 'low'); });
  }

  function eagerLoad(n){
    const imgs=[...document.querySelectorAll('#grid img[data-src]')].slice(0,n);
    imgs.forEach(img=>{ if(!img.src){ img.src = img.getAttribute('data-src'); img.removeAttribute('data-src'); }});
  }

  function apply(){
    const qNameK   = normalizeForSearch(nameQ.value||'');
    const qCodeK   = normalizeForSearch(codeQ.value||'');
    const qPackK   = normalizeForSearch(packQ.value||'');
    const qRarityK = normalizeForSearch(rarityQ.value||'');

    const qNameL   = normalizeLatin(nameQ.value||'');
    const qCodeL   = normalizeLatin(codeQ.value||'');
    const qPackL   = normalizeLatin(packQ.value||'');
    const qRarityL = normalizeLatin(rarityQ.value||'');

    const matchEither = (kana, latin, qK, qL) => {
      if (!qK && !qL) return true;
      let ok = false;
      if (qK && kana.includes(qK)) ok = true;
      if (qL && latin.includes(qL)) ok = true;
      return ok;
    };

    VIEW = ALL.filter(it =>
      matchEither(it._name,        it._name_lat,        qNameK,   qNameL)   &&
      matchEither(it._code,        it._code_lat,        qCodeK,   qCodeL)   &&
      matchEither(it._packbooster, it._packbooster_lat, qPackK,   qPackL)   &&
      matchEither(it._rarity,      it._rarity_lat,      qRarityK, qRarityL)
    );

    if(currentSort==='desc') VIEW.sort((a,b)=>(b.price||0)-(a.price||0));
    else if(currentSort==='asc') VIEW.sort((a,b)=>(a.price||0)-(b.price||0));

    page=1; render();
  }

  function render(){
    grid.className = showImages ? 'grid grid-img' : 'grid grid-list';
    const total=VIEW.length;
    const pages=Math.max(1, Math.ceil(total/PER_PAGE_ADJ));
    if(page>pages) page=pages;
    const start=(page-1)*PER_PAGE_ADJ;
    const rows=VIEW.slice(start, start+PER_PAGE_ADJ);
    grid.innerHTML = rows.map(showImages ? cardHTML_img : cardHTML_list).join('');

    if(showImages){
      grid.querySelectorAll('.th').forEach(th=>{
        th.addEventListener('click', ()=>{
          const src = th.getAttribute('data-full') || th.querySelector('img')?.src || '';
          if(!src) return; viewerImg.src = src; viewer.classList.add('show');
        });
      });
    }

    const prev = page>1 ? `<a href="#" data-jump="prev">← 前のページ</a>` : `<a class="disabled">← 前のページ</a>`;
    const next = page<pages ? `<a href="#" data-jump="next">次のページ →</a>` : `<a class="disabled">次のページ →</a>`;
    const navHtml = `${prev} &nbsp;&nbsp; <strong>${page}/${pages}</strong> &nbsp;&nbsp; ${next}`;
    navs.forEach(n=>{
      n.innerHTML=navHtml;
      n.onclick=(e)=>{
        const a=e.target.closest('a[data-jump]'); if(!a) return;
        e.preventDefault();
        const j=a.dataset.jump; if(j==='prev') page--; else if(j==='next') page++;
        render(); window.scrollTo({ top: 0, behavior: 'smooth' });
      };
    });

    shrinkPrices(grid);
    if (showImages) {
      setupIO();
      eagerLoad(eager1);
      setTimeout(()=>eagerLoad(eager2), 600);
    }
  }

  function setActiveSort(){
    btnDesc?.setAttribute('aria-pressed', currentSort==='desc' ? 'true':'false');
    btnAsc ?.setAttribute('aria-pressed', currentSort==='asc'  ? 'true':'false');
    btnNone?.setAttribute('aria-pressed', currentSort===null    ? 'true':'false');
    btnDesc?.classList.toggle('active', currentSort==='desc');
    btnAsc ?.classList.toggle('active', currentSort==='asc');
    btnNone?.classList.toggle('active', currentSort===null);
  }
  function setImgBtn(){
    if (!btnImg) return;
    btnImg.textContent = showImages ? '画像OFF' : '画像ON';
    btnImg.classList.toggle('active', showImages);
    btnImg.setAttribute('aria-pressed', showImages ? 'true' : 'false');
  }
  function toggleImages(e){
    if (e) { e.preventDefault(); e.stopPropagation(); }
    showImages = !showImages;
    localStorage.setItem('showImages', showImages ? '1' : '0');
    setImgBtn();
    render();
  }

  btnDesc?.addEventListener('click', ()=>{ currentSort = (currentSort==='desc') ? null : 'desc'; setActiveSort(); apply(); });
  btnAsc ?.addEventListener('click', ()=>{ currentSort = (currentSort==='asc') ? null : 'asc'; setActiveSort(); apply(); });
  btnNone?.addEventListener('click', ()=>{ currentSort = null; setActiveSort(); apply(); });
  btnImg ?.addEventListener('click', toggleImages);

  const DEBOUNCE = (isMobile || slowNet || cores <= 4) ? 240 : 120;
  function onInputDebounced(el){ el.addEventListener('input', ()=>{ clearTimeout(el._t); el._t=setTimeout(apply,DEBOUNCE); }); }
  [nameQ, codeQ, packQ, rarityQ].forEach(onInputDebounced);

  function closeViewer(){ viewer.classList.remove('show'); viewerImg.src=''; }
  viewerClose?.addEventListener('click', closeViewer);
  viewer?.addEventListener('click', (e)=>{ if(e.target===viewer) closeViewer(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeViewer(); });

  window.addEventListener('resize', () => shrinkPrices(document));

  setActiveSort(); setImgBtn(); apply();
})();
</script></body></html>